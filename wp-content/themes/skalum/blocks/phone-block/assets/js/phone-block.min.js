const cvs=document.getElementById("pushes"),ctx=cvs.getContext("2d"),BASE=window.SkalumPhoneBlock&&window.SkalumPhoneBlock.imgBase||"/wp-content/themes/skalum/blocks/phone-block/assets/images/",ASSETS={bg:BASE+"iphone.png",cards:["push_1.png","push_2.png","push_3.png","push_4.png"].map(t=>BASE+t)},LAYOUT={stackX:.075,stackY:.52,cardW:.85,gap:10,rows:3},TIMING={arrivalEveryMs:3600,pushPxPerMs:.12,damping:.095,settlePx:.9,growFrom:.9,growOvershoot:.16,growSpeed:.003,constraintsIters:3,TICK_MS:1500},FRAME_RATE=60,FRAME_MS=1e3/60,PUSH_ACCEL=2e3*TIMING.pushPxPerMs,DAMPING_RATE=-Math.log(1-TIMING.damping)/(2/60),PAUSE_DAMPING_RATE=-Math.log(.85)/(1/60),GROW_RATE=2e3*TIMING.growSpeed,INITIAL_KICK=TIMING.pushPxPerMs*FRAME_MS*60,SETTLE_VY_FRAME=.02,SETTLE_VY=1.2,ROWS_OK_VY=2.4;function fitDPR(){const t=Math.max(1,window.devicePixelRatio||1),e=parseInt(getComputedStyle(cvs).width,10),n=parseInt(getComputedStyle(cvs).height,10);cvs.width=Math.round(e*t),cvs.height=Math.round(n*t),ctx.setTransform(t,0,0,t,0,0)}fitDPR(),addEventListener("resize",fitDPR);const load=t=>new Promise(e=>{const n=new Image;n.onload=()=>e(n),n.onerror=()=>e(null),n.src=t});!async function(){const t=await load(ASSETS.bg),e=(await Promise.all(ASSETS.cards.map(load))).filter(Boolean);if(!t||0===e.length)return;const n=e[0].naturalWidth,o=e[0].naturalHeight;function a(){const t=parseInt(getComputedStyle(cvs).width,10),e=parseInt(getComputedStyle(cvs).height,10),a=Math.round(t*LAYOUT.cardW),s=a/n,r=Math.round(o*s),c=Math.round(t*LAYOUT.stackX),i=Math.round(e*LAYOUT.stackY);return{W:t,H:e,cardW:a,cardH:r,x:c,yTop:i,screenBottom:i+(r+LAYOUT.gap)*LAYOUT.rows-LAYOUT.gap}}let s=a();addEventListener("resize",()=>{fitDPR(),s=a()});const r=t=>s.yTop+t*(s.cardH+LAYOUT.gap);let c=1,i=e.slice(0,LAYOUT.rows).map((t,e)=>({id:c++,img:t,y:r(e),vy:0,s:1,a:1})),l=LAYOUT.rows%e.length,d=!1,g=performance.now()-TIMING.arrivalEveryMs+500,u=0;const h={slot1Id:null,slot2Id:null};function I(){h.slot1Id=h.slot2Id=null}function m(t,e){u=Math.max(u,e+t)}let M=performance.now();requestAnimationFrame(function n(o){const a=Math.min(50,o-M);M=o;const T=a/1e3;if(!d&&o-g>=TIMING.arrivalEveryMs&&(g=o,d||0===i.length||(d=!0,I(),i[0].vy+=INITIAL_KICK)),d){const t=o<u;if(t||(i[0].vy+=PUSH_ACCEL*T),t)for(const t of i)t.vy*=Math.exp(-PAUSE_DAMPING_RATE*T);for(const t of i)t.y+=t.vy*T,t.vy*=Math.exp(-DAMPING_RATE*T);!function(){for(let t=0;t<TIMING.constraintsIters;t++)for(let t=0;t<i.length-1;t++){const e=i[t],n=i[t+1],o=s.cardH+LAYOUT.gap-(n.y-e.y);if(o>0){const t=.5*o;e.y-=t,n.y+=t,n.vy+=.35*e.vy}}}(),i[0]&&i[0].id!==h.slot1Id&&i[0].y>=r(1)-2&&(h.slot1Id=i[0].id,m(TIMING.TICK_MS,o)),i[1]&&i[1].id!==h.slot2Id&&i[1].y>=r(2)-2&&(h.slot2Id=i[1].id,m(TIMING.TICK_MS,o)),function(){if(d&&i[0].y>=r(1)&&!i.some(t=>t.__growing)){const t=e[l++%e.length];i.unshift({id:c++,img:t,y:r(0),vy:0,s:TIMING.growFrom,a:0,__growing:!0}),h.slot1Id=null}}(),function(t){const e=i[0];if(!e||!e.__growing)return;const n=t/1e3,o=e.s<1+TIMING.growOvershoot?1+TIMING.growOvershoot:1,a=1-Math.exp(-GROW_RATE*n);e.s+=(o-e.s)*a,e.a+=(1-e.a)*a*.9,Math.abs(e.s-1)<.01&&(e.s=1,e.a=1,e.__growing=!1)}(a),function(){if(!i.slice(0,LAYOUT.rows).every((t,e)=>Math.abs(t.y-r(e))<.08*s.cardH&&Math.abs(t.vy)<2.4))return;let t=!1;i=i.filter((e,n)=>!(e.y>=s.screenBottom&&!t&&n>=LAYOUT.rows&&(t=!0,1))),!t&&i.length<=LAYOUT.rows&&i.slice(0,LAYOUT.rows).every((t,e)=>Math.abs(t.y-r(e))<TIMING.settlePx&&Math.abs(t.vy)<1.2&&!t.__growing)&&(d=!1,I())}()}!function(){ctx.clearRect(0,0,s.W,s.H),ctx.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,s.W,s.H),ctx.save(),ctx.beginPath(),ctx.rect(0,0,s.W,s.screenBottom),ctx.clip();let e=null,n=1/0;for(const t of i){const o=Math.abs(t.y-r(0));o<n&&(n=o,e=t)}const o=[...i].sort((t,e)=>t.y-e.y);for(const t of o){const n=s.cardW*t.s,o=s.cardH*t.s,a=s.x+(s.cardW-n)/2,r=Math.round(t.y)+(s.cardH-o)/2;ctx.globalAlpha=t===e?1:.92*t.a,ctx.drawImage(t.img,0,0,t.img.naturalWidth,t.img.naturalHeight,a,r,n,o)}ctx.globalAlpha=1,ctx.restore();const a=.5*s.H,c=s.H-a+2,l=ctx.createLinearGradient(0,c,0,s.H);l.addColorStop(0,"rgba(0,0,0,0)"),l.addColorStop(1,"rgba(0,0,0,0.9)"),ctx.fillStyle=l,ctx.fillRect(0,c,s.W,a-2)}(),requestAnimationFrame(n)})}(),function(){const t=document.getElementById("phone_time"),e=document.getElementById("phone_date"),n=navigator.languages&&navigator.languages[0]||navigator.language||"en-US",o=document.documentElement,a=o?.dataset?.locale||n,s=new Intl.DateTimeFormat(a,{weekday:"long"}),r=new Intl.DateTimeFormat(a,{month:"long"});function c(){const n=new Date;var o;t.textContent=`${((o=n).getHours()+11)%12+1}:${o.getMinutes().toString().padStart(2,"0")}`,e.textContent=function(t){return`${s.format(t)}, ${t.getDate()} ${r.format(t)}`}(n)}c(),function(){const t=new Date,e=1e3*(60-t.getSeconds())-t.getMilliseconds();setTimeout(()=>{c(),setInterval(c,6e4)},Math.max(0,e))}(),document.addEventListener("visibilitychange",()=>{document.hidden||c()}),document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".js-rotating-titles");if(!t)return;const e=Array.from(t.querySelectorAll("h2"));let n=0;e[0].classList.add("active"),setInterval(function(){const t=e[n],o=(n+1)%e.length,a=e[o];t.classList.remove("active"),setTimeout(()=>{a.classList.add("active"),n=o},600)},4600)})}();